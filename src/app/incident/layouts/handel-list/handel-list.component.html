<div class="handler-list-container">
  <div class="filter-section">
    <div class="filter-controls">
      <mat-form-field appearance="outline" class="status-dropdown">
        <mat-select [(ngModel)]="selectedStatus" placeholder="Status">
          <mat-option value="">All Statuses</mat-option>
          <mat-option *ngFor="let status of statusOptions" [value]="status">{{ status }}</mat-option>
        </mat-select>
      </mat-form-field>
      <mat-form-field appearance="outline" class="status-dropdown">
        <mat-select [(ngModel)]="selectedSeverity" placeholder="Severity">
          <mat-option value="">All Severities</mat-option>
          <mat-option *ngFor="let severity of severityOptions" [value]="severity">{{ severity }}</mat-option>
        </mat-select>
      </mat-form-field>
      <mat-form-field appearance="outline" class="search-field">
        <input matInput [(ngModel)]="searchText" (ngModelChange)="onSearchChange()" placeholder="Search..." />
      </mat-form-field>
      <button mat-raised-button class="filter-btn" (click)="onFilter()">
        Filter
      </button>
    </div>
  </div>

  <div class="error-message" *ngIf="errorMessage">{{ errorMessage }}</div>

  <div class="table-container">
    <table class="handlers-table">
      <thead>
        <tr>
          <th (click)="onSort('title')">
            Title
            <mat-icon class="sort-icon">unfold_more</mat-icon>
          </th>
          <th (click)="onSort('severity')">
            Severity
            <mat-icon class="sort-icon">unfold_more</mat-icon>
          </th>
          <th (click)="onSort('status')">
            Status
            <mat-icon class="sort-icon">unfold_more</mat-icon>
          </th>
          <th (click)="onSort('createdAt')">
            Created At
            <mat-icon class="sort-icon">unfold_more</mat-icon>
          </th>
          <th>Owner</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngIf="isLoading">
          <td colspan="5" class="empty-state">Loading incidents...</td>
        </tr>
        <tr *ngIf="!isLoading && handlers.length === 0">
          <td colspan="5" class="empty-state">No incidents found.</td>
        </tr>
        <tr *ngFor="let handler of handlers" class="handler-row" (click)="openIncident(handler.id)">
          <td class="title-cell">{{ handler.title }}</td>
          <td class="severity-cell">{{ handler.severity }}</td>
          <td class="status-cell">
            <span class="status-badge" [ngClass]="'status-' + getStatusClass(handler.status)">
              {{ handler.status }}
            </span>
          </td>
          <td class="created-at-cell">{{ handler.createdAt }}</td>
          <td class="owner-cell">{{ handler.owner }}</td>
        </tr>
      </tbody>
    </table>
  </div>
  <div class="pagination-container">
    <span class="page-info">Page {{ currentPage }} of {{ totalPages }}</span>
    <button mat-button [disabled]="currentPage === 1 || isLoading" (click)="goToPage(1)" class="nav-btn">
      &lt;&lt;
    </button>
    <button mat-button
      *ngFor="let page of displayPages"
      [class.active]="page === currentPage"
      [disabled]="isLoading"
      (click)="goToPage(page)"
      class="page-btn">
      {{ page }}
    </button>
    <button mat-button [disabled]="currentPage === totalPages || isLoading" (click)="goToPage(totalPages)" class="nav-btn">
      &gt;&gt;
    </button>
  </div>
</div>
