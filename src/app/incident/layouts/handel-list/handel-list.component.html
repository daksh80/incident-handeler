<div class="handler-list-container">
  <div class="filter-section">
    <div class="filter-controls">
      <mat-form-field appearance="outline" class="status-inline-dropdown">
        <mat-select [ngModel]="selectedStatus" (ngModelChange)="onStatusChange($event)">
          <mat-select-trigger>
            {{ selectedStatus ? getStatusLabel(selectedStatus) : 'Status' }}
          </mat-select-trigger>
          <mat-option value="">All Statuses</mat-option>
          <mat-option *ngFor="let status of statusOptions" [value]="status">{{ getStatusLabel(status) }}</mat-option>
        </mat-select>
      </mat-form-field>
      <mat-form-field appearance="outline" class="search-field">
        <input matInput [ngModel]="searchText" (ngModelChange)="onSearchChange($event)" placeholder="Search..." />
      </mat-form-field>
      <button mat-raised-button class="filter-btn" (click)="onFilterClick()">
        Filter
      </button>
    </div>
  </div>

  <div class="error-message" *ngIf="errorMessage">{{ errorMessage }}</div>

  <div class="table-container">
    <table class="handlers-table">
      <thead>
        <tr>
          <th (click)="onSort('title')">
            Title
          </th>
          <th (click)="onSort('severity')">
            Severity
            <mat-icon class="sort-icon">unfold_more</mat-icon>
          </th>
          <th (click)="onSort('status')">
            Status
          </th>
          <th (click)="onSort('createdAt')">
            Created At
          </th>
          <th>Owner</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngIf="isLoading">
          <td colspan="5" class="empty-state">Loading incidents...</td>
        </tr>
        <tr *ngIf="!isLoading && handlers.length === 0">
          <td colspan="5" class="empty-state">No incidents found.</td>
        </tr>
        <tr *ngFor="let handler of handlers" class="handler-row" (click)="onOpenIncident(handler.id)">
          <td class="title-cell">{{ handler.title }}</td>
          <td class="severity-cell">{{ handler.severity }}</td>
          <td class="status-cell">
            <span class="status-badge" [ngClass]="'status-' + getStatusClass(handler.status)">
              {{ getStatusLabel(handler.status) }}
            </span>
          </td>
          <td class="created-at-cell">{{ handler.createdAt | incidentDate:'short' }}</td>
          <td class="owner-cell">{{ handler.owner }}</td>
        </tr>
      </tbody>
    </table>
  </div>
  <div class="pagination-container">
    <span class="page-info">Page {{ currentPage }} of {{ totalPages }}</span>
    <button mat-button [disabled]="currentPage === 1 || isLoading" (click)="onGoToPage(1)" class="nav-btn">
      &lt;&lt;
    </button>
    <button mat-button
      *ngFor="let page of displayPages"
      [class.active]="page === currentPage"
      [disabled]="isLoading"
      (click)="onGoToPage(page)"
      class="page-btn">
      {{ page }}
    </button>
    <button
      mat-button
      *ngIf="displayPages.length && displayPages[displayPages.length - 1] !== totalPages"
      [disabled]="isLoading"
      (click)="onGoToPage(totalPages)"
      class="page-btn">
      {{ totalPages }}
    </button>
    <button mat-button [disabled]="currentPage === totalPages || isLoading" (click)="onGoToPage(currentPage + 1)" class="nav-btn">
      Next &gt;&gt;
    </button>
  </div>
</div>
