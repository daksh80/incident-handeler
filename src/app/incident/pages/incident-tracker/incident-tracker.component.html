<div class="tracker-wrapper">
  <div class="tracker-card">
    <app-incident-header [title]="'Incident Tracker'" [showActions]="false"></app-incident-header>

    <div class="tracker-content">
      <app-incident-create-form
        *ngIf="isCreateMode"
        [incident]="incident"
        [serviceOptions]="serviceOptions"
        [severityOptions]="severityOptions"
        [statusOptions]="statusOptions"
        [disableCreate]="!isCreateFormValid"
        (fieldChange)="onDraftFieldChange($event)"
        (createClicked)="createIncident()"
        (cancelClicked)="cancel()"
      ></app-incident-create-form>

      <ng-container *ngIf="!isCreateMode">
        <h2 class="incident-title">{{ incident.title }}</h2>

        <app-incident-field-row label="Service:">
          <span class="plain-text">{{ incident.service }}</span>
        </app-incident-field-row>

        <app-incident-field-row label="Severity:">
          <mat-form-field appearance="outline" class="input-field select-field">
            <mat-select [(ngModel)]="incident.severity">
              <mat-option *ngFor="let severity of severityOptions" [value]="severity">{{ severity }}</mat-option>
            </mat-select>
          </mat-form-field>
        </app-incident-field-row>

        <app-incident-field-row label="Status:">
          <mat-form-field appearance="outline" class="input-field select-field">
            <mat-select [(ngModel)]="incident.status">
              <mat-option *ngFor="let status of statusOptions" [value]="status">{{ status }}</mat-option>
            </mat-select>
          </mat-form-field>
        </app-incident-field-row>

        <app-incident-field-row label="Assigned To:">
          <mat-form-field appearance="outline" class="input-field">
            <input matInput [(ngModel)]="incident.assignedTo" />
          </mat-form-field>
        </app-incident-field-row>

        <app-incident-field-row label="Occurred At:">
          <span class="plain-text">{{ incident.occurredAt }}</span>
        </app-incident-field-row>

        <app-incident-field-row label="Summary" [stacked]="true">
          <mat-form-field appearance="outline" class="summary-field">
            <textarea matInput rows="3" [(ngModel)]="incident.summary"></textarea>
          </mat-form-field>
        </app-incident-field-row>

        <div class="tracker-actions">
          <button mat-flat-button class="save-btn" (click)="saveChanges()">Save Changes</button>
          <button mat-stroked-button class="cancel-btn" (click)="cancel()">Cancel</button>
        </div>
      </ng-container>
    </div>
  </div>
</div>
